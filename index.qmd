---
title: "Styringsinformasjon - sykepengeløsningen"
date-modified: last-modified
format:
    html:
        code-fold: true
        self-contained: true
---

```{python}
#| echo: false
import pandas as pd
```
```{python}
#| echo: false
import warnings
warnings.filterwarnings("ignore", "Your application has authenticated using end user credentials")
```

```{python}
#| echo: false
from google.cloud import bigquery

client = bigquery.Client(location="europe-north1", project="tbd-prod-eacd")
```

# 1. Mottatte søknader ny sykepengeløsning

```{python}
#| echo: false
import datetime as dt

print(f"Nøkkeltall per {dt.datetime.now().date()}")
```

## Nøkkeltall - inneværende måned

```{python}
QUERY = """--sql
SELECT 18629 as `Mottatt denne måneden`, 187 as `Mottatt i dag`, 456 as `Mottatt i går`, 46372 as `Innsendt forrige uke`
"""
query_job = client.query(QUERY)
rows = query_job.result()

stats = [dict(row) for row in rows][0]
```

```{python}

for key, value in stats.items():
    print(f'### {key}')
    print(f'{value}')
```


```{python}
QUERY = """--sql
SELECT count(1) FROM `tbd-prod-eacd.styringsinfo_dataset.styringsinfo_sendt_soknad_view` 
"""
query_job = client.query(QUERY)
rows = query_job.result()

for row in rows:
    print(row.values())
```

```{python}

QUERY = f"""
    SELECT
        FORMAT_TIMESTAMP('%G-%V', soknad_mottatt, 'Europe/Oslo') as week,
        COUNT(*) as total,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Monday') as Monday,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Tuesday') as Tuesday,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Wednesday') as Wednesday,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Thursday') as Thursday,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Friday') as Friday,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Saturday') as Saturday,
        COUNTIF(FORMAT_TIMESTAMP('%A', soknad_mottatt, 'Europe/Oslo') = 'Sunday') as Sunday
    FROM `tbd-prod-eacd.styringsinfo_dataset.styringsinfo_sendt_soknad_view`
    GROUP BY week
    ORDER BY week DESC
"""

query_job = client.query(QUERY)

df = query_job.to_dataframe()

```

```{python}
# Usikker på hvordan jeg får til å rendre Markdown med Quarto
from IPython.display import display_markdown
display_markdown(df.to_markdown())
print(df.to_markdown())
```

```{python}

import datetime as dt

print(f'Sist oppdatert: {dt.datetime.now()}')
```